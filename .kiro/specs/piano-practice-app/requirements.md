# 要件定義書

## 概要

MIDI対応の電子ピアノをPCに接続し、ブラウザ上でコードやフレーズを音ゲー風に練習できるWebアプリケーション。TypeScript + Tone.jsを使用してフロントエンド中心で開発し、リアルタイムでのMIDI入力を受け取って練習の進捗を視覚的にフィードバックする。

## 要件

### 要件 1

**ユーザーストーリー:** ピアノ学習者として、MIDI対応の電子ピアノをブラウザに接続して、リアルタイムで入力を認識してもらいたい

#### 受け入れ基準

1. WHEN ユーザーがブラウザでアプリにアクセス THEN システムはMIDI機器の接続許可を求める
2. WHEN MIDI機器が接続されている THEN システムは利用可能なMIDI入力デバイスを検出して表示する
3. WHEN ユーザーがピアノの鍵盤を押す THEN システムはリアルタイムでMIDI入力（ノート番号、ベロシティ、タイミング）を受信する
4. IF MIDI機器が接続されていない THEN システムは接続を促すメッセージを表示する

### 要件 2

**ユーザーストーリー:** ピアノ学習者として、画面上に表示されるコードやフレーズを見ながら練習したい

#### 受け入れ基準

1. WHEN アプリが起動 THEN システムは練習用のコード進行またはフレーズを画面に表示する
2. WHEN 練習が開始 THEN システムは音ゲー風のインターフェースで演奏すべき音符を時系列で表示する
3. WHEN 音符が演奏タイミングに到達 THEN システムは視覚的なハイライトで演奏タイミングを示す
4. WHEN ユーザーが正しい鍵盤を押す THEN システムは正解の視覚フィードバック（色の変化、エフェクト等）を表示する

### 要件 3

**ユーザーストーリー:** ピアノ学習者として、自分の演奏の正確性をリアルタイムで確認したい

#### 受け入れ基準

1. WHEN ユーザーが鍵盤を押す THEN システムは演奏された音符と期待される音符を比較する
2. IF 正しい音符が正しいタイミングで演奏された THEN システムは正解として記録し、スコアを加算する
3. IF 間違った音符が演奏された THEN システムは不正解の視覚フィードバック（赤色表示等）を提供する
4. WHEN 練習セッションが完了 THEN システムは正解率、タイミング精度、総合スコアを表示する

### 要件 4

**ユーザーストーリー:** ピアノ学習者として、様々な難易度やジャンルの練習コンテンツを選択したい

#### 受け入れ基準

1. WHEN アプリが起動 THEN システムは複数の練習コンテンツ（基本コード、コード進行、簡単なメロディ）を提供する
2. WHEN ユーザーが練習コンテンツを選択 THEN システムは選択されたコンテンツの詳細（難易度、BPM、キー等）を表示する
3. WHEN 練習が開始 THEN システムは選択されたコンテンツに基づいて音符の表示とタイミングを制御する
4. IF ユーザーが練習を途中で停止 THEN システムは進捗を保持し、再開可能にする

### 要件 5

**ユーザーストーリー:** ピアノ学習者として、練習をサポートする追加機能を利用したい

#### 受け入れ基準

1. WHEN 練習コンテンツが再生される THEN システムはメトロノーム機能を提供する
2. WHEN ユーザーが練習を開始 THEN システムは練習のテンポ（BPM）を調整可能にする
3. WHEN 練習が進行中 THEN システムは現在の小節位置や進捗を表示する
4. IF ユーザーがメトロノームをオフにしたい THEN システムはメトロノームのオン/オフを切り替える機能を提供する