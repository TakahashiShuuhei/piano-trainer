# 実装計画

- [x] 1. プロジェクト構造とコアインターフェースの設定
  - TypeScriptプロジェクトの初期化とビルド設定
  - 主要インターフェース（MIDIInputManager、GameEngine、UIRenderer等）の定義
  - 基本的なHTMLテンプレートとCanvasエレメントの作成
  - _要件: 1.1, 2.1_

- [x] 2. MIDI入力システムの実装
  - [x] 2.1 MIDIInputManagerクラスの実装
    - Tone.js MIDIオブジェクトを使用したMIDI機器検出と接続
    - ノートオン/オフイベントの処理とコールバック機能
    - _要件: 1.1, 1.2, 1.3_

  - [x] 2.2 MIDI入力とTone.js Transportの同期
    - MIDI入力タイムスタンプをTone.Transport.nowに変換
    - 音程変換機能（Tone.Midi().toFrequency()）の実装
    - _要件: 1.3, 3.1_

  - [x] 2.3 MIDI入力の単体テスト
    - MockMIDIInputを使用したテストケース作成
    - 異なるMIDI機器での動作確認テスト
    - _要件: 1.1, 1.4_

- [ ] 3. Canvas描画システムの実装
  - [x] 3.1 UIRendererクラスの基本実装
    - Canvas初期化とコンテキスト取得
    - 基本的な描画メソッド（矩形、円、テキスト）の実装
    - _要件: 2.1, 2.2_

  - [x] 3.2 音ゲー風ノート表示の実装
    - 落下するノートの描画とアニメーション
    - 鍵盤位置に対応したノート配置システム
    - _要件: 2.2, 2.3_

  - [x] 3.3 アニメーションループとフレーム管理
    - requestAnimationFrameを使用した60FPS描画ループ
    - 差分更新による描画最適化
    - _要件: 2.2, 2.3_

  - [ ] 3.4 UIRenderer単体テスト
    - Canvas描画機能のテストケース
    - アニメーション状態のテスト
    - _要件: 2.1, 2.2_

- [ ] 4. 音楽的タイミングシステムとコンテンツ管理の実装
  - [ ] 4.1 音楽的タイミングシステムの実装
    - 四分音符を基準とした相対的タイミング管理
    - BPMベースの実時間変換機能
    - 音楽的単位（四分音符、八分音符、小節等）の定義
    - _要件: 5.1, 5.3_

  - [ ] 4.2 URLパラメータベースのコンテンツ読み込み
    - URLパラメータからJSONコンテンツを読み込み
    - file_urlパラメータでの外部JSONファイル対応
    - コンテンツフォーマットの標準化
    - _要件: 4.1, 4.2_

- [ ] 5. ゲームエンジンとスコア評価の実装
  - [ ] 5.1 GameEngineクラスの実装
    - ゲーム状態管理（開始、一時停止、停止）
    - 音楽的タイミングシステムとの統合
    - _要件: 2.1, 4.1, 4.2_

  - [ ] 5.2 ScoreEvaluatorクラスの実装
    - 音楽的タイミングベースの精度評価ロジック
    - タイミング許容範囲の音楽的定義（32分音符単位等）
    - スコア計算と正解率算出
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 5.3 リアルタイム演奏評価の統合
    - MIDI入力と期待される音符の比較処理
    - 音楽的タイミングでの判定処理
    - 視覚的フィードバック（正解/不正解の表示）の実装
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 5.4 ゲームエンジン単体テスト
    - 音楽的タイミングシステムのテスト
    - 様々なBPMでの動作確認
    - エッジケース（同時押し、長押し）のテスト
    - _要件: 3.1, 3.2_

- [ ] 6. メトロノームとオーディオシステムの実装
  - [ ] 6.1 MetronomeServiceクラスの実装
    - 音楽的タイミングシステムと連携したBPM管理
    - メトロノーム音の再生とビート通知
    - リアルタイムBPM変更対応
    - _要件: 5.1, 5.2_

  - [ ] 6.2 オーディオフィードバックシステム
    - 正解/不正解時の効果音
    - ノートヒット時のオーディオフィードバック
    - 音量調整機能
    - _要件: 3.1, 3.2_

  - [ ] 6.3 MetronomeService単体テスト
    - BPM変更とタイミング精度のテスト
    - 音楽的タイミングシステムとの同期テスト
    - _要件: 5.1, 5.2_

- [ ] 7. 高度なコンテンツ機能の実装
  - [ ] 7.1 ContentManagerクラスの拡張
    - 音楽的タイミングベースのコンテンツ管理
    - 複数BPMでの同一コンテンツ対応
    - コンテンツメタデータ管理
    - _要件: 4.1, 4.2, 4.3_

  - [ ] 7.2 カスタムコンテンツ作成機能
    - ユーザーが独自の練習パターンを作成する機能
    - 音楽的タイミングでのコンテンツ編集
    - コンテンツの保存と読み込み（LocalStorage使用）
    - _要件: 4.2, 4.4_

  - [ ] 7.3 ContentManager単体テスト
    - 音楽的タイミングシステムとの統合テスト
    - URLパラメータ読み込み機能のテスト
    - データ構造の妥当性検証テスト
    - _要件: 4.1, 4.2_

- [ ] 8. エラーハンドリングとフォールバック機能の実装
  - [ ] 7.1 MIDI関連エラーハンドリング
    - MIDI機器未接続時のキーボード入力フォールバック
    - 接続エラー時の自動再試行機能
    - _要件: 1.4_

  - [ ] 7.2 ユーザーフレンドリーなエラーメッセージ
    - 技術的エラーの分かりやすい説明表示
    - 解決方法の提案とガイダンス
    - _要件: 1.4_

  - [ ] 7.3 グレースフルデグラデーション
    - Web Audio API未対応環境での動作確保
    - 機能制限時の代替UI表示
    - _要件: 1.4, 5.4_

- [ ] 9. 統合とポリッシュ
  - [ ] 8.1 全コンポーネントの統合
    - 各システム間のデータフローの接続
    - イベント駆動アーキテクチャの実装
    - _要件: 全要件_

  - [ ] 8.2 パフォーマンス最適化
    - Canvas描画の最適化とメモリ管理
    - イベントリスナーの適切な登録・解除
    - _要件: 2.3, 3.3_

  - [ ] 8.3 ユーザーインターフェースの改善
    - テーマ切り替え機能（ライト/ダーク）
    - レスポンシブデザインの実装
    - _要件: 2.1, 2.2_

  - [ ] 8.4 統合テストとE2Eテスト
    - 実際のMIDI機器を使用した動作確認
    - ブラウザ互換性テスト（Chrome、Firefox、Safari）
    - _要件: 全要件_