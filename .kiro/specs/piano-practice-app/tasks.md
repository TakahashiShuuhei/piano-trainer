# 実装計画

- [x] 1. プロジェクト構造とコアインターフェースの設定
  - TypeScriptプロジェクトの初期化とビルド設定
  - 主要インターフェース（MIDIInputManager、GameEngine、UIRenderer等）の定義
  - 基本的なHTMLテンプレートとCanvasエレメントの作成
  - _要件: 1.1, 2.1_

- [ ] 2. MIDI入力システムの実装
  - [x] 2.1 MIDIInputManagerクラスの実装
    - Tone.js MIDIオブジェクトを使用したMIDI機器検出と接続
    - ノートオン/オフイベントの処理とコールバック機能
    - _要件: 1.1, 1.2, 1.3_

  - [x] 2.2 MIDI入力とTone.js Transportの同期
    - MIDI入力タイムスタンプをTone.Transport.nowに変換
    - 音程変換機能（Tone.Midi().toFrequency()）の実装
    - _要件: 1.3, 3.1_

  - [x] 2.3 MIDI入力の単体テスト
    - MockMIDIInputを使用したテストケース作成
    - 異なるMIDI機器での動作確認テスト
    - _要件: 1.1, 1.4_

- [ ] 3. Canvas描画システムの実装
  - [ ] 3.1 UIRendererクラスの基本実装
    - Canvas初期化とコンテキスト取得
    - 基本的な描画メソッド（矩形、円、テキスト）の実装
    - _要件: 2.1, 2.2_

  - [ ] 3.2 音ゲー風ノート表示の実装
    - 落下するノートの描画とアニメーション
    - 鍵盤位置に対応したノート配置システム
    - _要件: 2.2, 2.3_

  - [ ] 3.3 アニメーションループとフレーム管理
    - requestAnimationFrameを使用した60FPS描画ループ
    - 差分更新による描画最適化
    - _要件: 2.2, 2.3_

  - [ ] 3.4 UIRenderer単体テスト
    - Canvas描画機能のテストケース
    - アニメーション状態のテスト
    - _要件: 2.1, 2.2_

- [ ] 4. ゲームエンジンとスコア評価の実装
  - [ ] 4.1 GameEngineクラスの実装
    - ゲーム状態管理（開始、一時停止、停止）
    - 練習コンテンツの読み込みと管理
    - _要件: 2.1, 4.1, 4.2_

  - [ ] 4.2 ScoreEvaluatorクラスの実装
    - タイミング精度の評価ロジック（perfect/good/miss判定）
    - スコア計算と正解率算出
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 4.3 リアルタイム演奏評価の統合
    - MIDI入力と期待される音符の比較処理
    - 視覚的フィードバック（正解/不正解の表示）の実装
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 4.4 スコア評価ロジックの単体テスト
    - 様々なタイミング精度でのテストケース
    - エッジケース（同時押し、長押し）のテスト
    - _要件: 3.1, 3.2_

- [ ] 5. メトロノームとタイミングシステムの実装
  - [ ] 5.1 MetronomeServiceクラスの実装
    - Tone.js Transportを使用したBPM管理
    - メトロノーム音の再生とビート通知
    - _要件: 5.1, 5.2_

  - [ ] 5.2 タイミング同期システムの実装
    - Transport.scheduleを使用したゲームイベントのスケジューリング
    - 音楽的時間とゲーム時間の変換機能
    - _要件: 5.1, 5.3_

  - [ ] 5.3 進捗表示とテンポ調整機能
    - 現在の小節位置と進捗の表示
    - リアルタイムBPM調整機能
    - _要件: 5.2, 5.3_

  - [ ] 5.4 MetronomeService単体テスト
    - BPM変更とタイミング精度のテスト
    - Transport同期機能のテスト
    - _要件: 5.1, 5.2_

- [ ] 6. 練習コンテンツ管理システムの実装
  - [ ] 6.1 ContentManagerクラスの実装
    - 基本的なコード進行とフレーズのデータ定義
    - 練習コンテンツの読み込みと選択機能
    - _要件: 4.1, 4.2, 4.3_

  - [ ] 6.2 練習コンテンツのデータ構造実装
    - Note、PracticeContent、PracticeSessionインターフェースの実装
    - 難易度別コンテンツの分類と管理
    - _要件: 4.1, 4.2, 4.4_

  - [ ] 6.3 カスタムコンテンツ作成機能
    - ユーザーが独自の練習パターンを作成する機能
    - コンテンツの保存と読み込み（LocalStorage使用）
    - _要件: 4.2, 4.4_

  - [ ] 6.4 ContentManager単体テスト
    - コンテンツ読み込みと選択機能のテスト
    - データ構造の妥当性検証テスト
    - _要件: 4.1, 4.2_

- [ ] 7. エラーハンドリングとフォールバック機能の実装
  - [ ] 7.1 MIDI関連エラーハンドリング
    - MIDI機器未接続時のキーボード入力フォールバック
    - 接続エラー時の自動再試行機能
    - _要件: 1.4_

  - [ ] 7.2 ユーザーフレンドリーなエラーメッセージ
    - 技術的エラーの分かりやすい説明表示
    - 解決方法の提案とガイダンス
    - _要件: 1.4_

  - [ ] 7.3 グレースフルデグラデーション
    - Web Audio API未対応環境での動作確保
    - 機能制限時の代替UI表示
    - _要件: 1.4, 5.4_

- [ ] 8. 統合とポリッシュ
  - [ ] 8.1 全コンポーネントの統合
    - 各システム間のデータフローの接続
    - イベント駆動アーキテクチャの実装
    - _要件: 全要件_

  - [ ] 8.2 パフォーマンス最適化
    - Canvas描画の最適化とメモリ管理
    - イベントリスナーの適切な登録・解除
    - _要件: 2.3, 3.3_

  - [ ] 8.3 ユーザーインターフェースの改善
    - テーマ切り替え機能（ライト/ダーク）
    - レスポンシブデザインの実装
    - _要件: 2.1, 2.2_

  - [ ] 8.4 統合テストとE2Eテスト
    - 実際のMIDI機器を使用した動作確認
    - ブラウザ互換性テスト（Chrome、Firefox、Safari）
    - _要件: 全要件_